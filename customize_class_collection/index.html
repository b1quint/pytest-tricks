<!doctype html>
<meta charset="utf-8">
<link rel="stylesheet" href="../static/gen/styles.css?h=deb80edd">
<script type=text/javascript src="../static/gen/app.js?h=d668e5da" charset="utf-8"></script>
<link rel="stylesheet" href="../static/pygments.css">
<title>Customize How py.test Collects Tests From Classes (2016) â€” pytest-tricks</title>
<body>
    <header>
        <div class="container">
            <h1><a href="../">pytest-tricks</a></h1>
        </div>
    </header>
    <hr>
    <div class="container page">
        
<div class="jumbotron">
    <div class="row">
        <div class="col-md-6">
            <h2>Customize How py.test Collects Tests From Classes</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <dl>
                <dt>Date
                <dd>Apr 20, 2016
                <dt>Author
                <dd><a href="https://twitter.com/nicoddemus">@nicoddemus</a>
                
                    <dt>Documentation
                    <dd><a href="http://pytest.org/latest/writing_plugins.html">http://pytest.org/latest/</a>
                
                
                    <dt>Tags
                    <dd>collection, hook
                
            </dl>
        </div>
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title"><strong>TL;DR</strong></h3>
                </div>
                <div class="panel-body">
                    <p>Use <code>pytest_pycollect_makeitem</code> to customize how tests are collected
from classes</p>

                </div>
            </div>
            <a href="https://twitter.com/share" class="twitter-share-button" data-text="Customize How py.test Collects Tests From Classes" data-via="nicoddemus" data-size="large" data-related="pytestdotorg" data-hashtags="python,pytest">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            <a href="https://twitter.com/nicoddemus" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @nicoddemus</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            <a aria-label="Star hackebrot/pytest-tricks on GitHub" data-style="mega" href="https://github.com/hackebrot/pytest-tricks" class="github-button">Star</a>
            <a aria-label="Fork hackebrot/pytest-tricks on GitHub" data-style="mega" href="https://github.com/hackebrot/pytest-tricks/fork" class="github-button">Fork</a>
            <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
        </div>
    </div>
</div>
<p id="content"><p>By default py.test collects all classes which start with <code>Test</code> that are found
in <code>test*.py</code> or <code>*test.py</code> modules. This behavior can be configured using the
<code>python_classes</code> and <code>python_files</code> <a href="http://pytest.org/latest/customize.html#confval-python_files">configuration
options</a>.</p>
<p>Also, it will out-of-the box collect classes which subclass <code>unittest.TestCase</code>
(regardless of their name), making it easy to run existing test suites.</p>
<p>But thanks to py.test's flexible plugin architecture, one can customize how
tests are collected from classes to suit almost any requirement.</p>
<h1>Collect All Subclasses of a Certain Class</h1>
<p>Recently someone asked in the
<a href="https://mail.python.org/pipermail/pytest-dev/2016-April/003556.html">pytest-dev</a>
mailing list how to make py.test collect all classes, that subclass from some
specific base class, independently of their name.</p>
<p>Suppose all your test classes subclass from a certain utility class:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestingUtils</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">connect_to_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">validate_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
<p>And all your tests are written in functions in subclasses of <code>TestingUtils</code>,
but that don't follow any particular naming convention:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BorgTests</span><span class="p">(</span><span class="n">TestingUtils</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_borg_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_database</span><span class="p">()</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">ValidationRules</span><span class="p">(</span><span class="n">TestingUtils</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_rule_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
<p>You can implement your own collection rules by implementing the
<a href="http://pytest.org/latest/writing_plugins.html#_pytest.hookspec.pytest_pycollect_makeitem">pytest_pycollect_makeitem</a> hook.</p>
<p>Simply add this code to a <code>conftest.py</code> file at the root of your tests'
directory and that's it:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inspect</span>

<span class="k">def</span> <span class="nf">pytest_pycollect_makeitem</span><span class="p">(</span><span class="n">collector</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">TestingUtils</span><span class="p">):</span>
        <span class="n">Class</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="n">_getcustomclass</span><span class="p">(</span><span class="s2">&quot;Class&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">collector</span><span class="p">)</span>
</pre></div>
<p>This won't interfere with the normal test collection mechanism, only add to it,
so classes prefixed with <code>Test</code> will also be collected as usual.</p>
</p>
<div class="comment-box">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title"><strong>COMMENTS</strong></h3>
        </div>
        <div class="panel-body">
            <div class="comments">
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() { this.page.identifier = "/customize_class_collection"; this.page.url = "http://hackebrot.github.io/pytest-tricks/customize_class_collection/"; };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = '//pytest-tricks.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript"
    rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div>
        </div>
    </div>
</div>

    </div>
    <hr>
    <footer>
        <div class="container">
            &copy; Copyright 2016 by Raphael Pierzina and pytest-dev team.
            <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
            <br />Built with <a href="https://www.getlektor.com/">Lektor</a>. Fork me on <a href="https://github.com/hackebrot/pytest-tricks/">GitHub</a>.
        </div>
    </footer>
</body>
