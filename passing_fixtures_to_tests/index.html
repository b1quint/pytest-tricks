<!doctype html>
<meta charset="utf-8">
<link rel="stylesheet" href="../static/gen/styles.css?h=deb80edd">
<script type=text/javascript src="../static/gen/app.js?h=d668e5da" charset="utf-8"></script>
<link rel="stylesheet" href="../static/pygments.css">
<title>Load pytest plugins dynamically (2016) — pytest-tricks</title>
<body>
    <header>
        <div class="container">
            <h1><a href="../">pytest-tricks</a></h1>
        </div>
    </header>
    <hr>
    <div class="container page">
        
<div class="jumbotron">
    <h2>Load pytest plugins dynamically</h2>
</div>
<div class="row">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><strong>Post</strong></h3>
            </div>
            <div class="panel-body">
                <dl>
                    <dt>Date
                    <dd>Dec 9, 2016
                    <dt>Author
                    <dd><a href="https://github.com/amarao">George Shuklin</a>
                    
                        <dt>Tags
                        <dd>fixture, invocation, plugins</dl>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><strong>TL;DR</strong></h3>
            </div>
            <div class="panel-body">
                <p>Load plugins dynamically by passing <code>plugins</code> to <code>pytest.main()</code></p>

            </div>
        </div>
        
        <a href="https://twitter.com/share" class="twitter-share-button" data-text="Load pytest plugins dynamically by George Shuklin" data-size="large" data-related="pytestdotorg" data-hashtags="python,pytest">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        

        

        <a aria-label="Star hackebrot/pytest-tricks on GitHub" data-style="mega" href="https://github.com/hackebrot/pytest-tricks" class="github-button">Star</a>
        <a aria-label="Fork hackebrot/pytest-tricks on GitHub" data-style="mega" href="https://github.com/hackebrot/pytest-tricks/fork" class="github-button">Fork</a>
        <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
    </div>
</div>
<p id="content"><p>There is a way to pass fixtures from python code to tests via plugins argument of <code>pytest.main()</code>.</p>
<h1>Creating fixture</h1>
<p>To create fixture we can use decorator <code>@pytest.fixture</code>:</p>
<div class="highlight"><pre><span></span><span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Information!&quot;</span>
</pre></div>
<h1>Passing plugin to pytest</h1>
<p>To pass something to pytest-executed tests we can use plugin mechanism of pytest. (For not let says that <code>myplugin</code> contains actual plugin, I’ll show later how to create it).</p>
<div class="highlight"><pre><span></span><span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="n">path_to_test</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">],</span> <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">myplugin</span><span class="p">])</span>
</pre></div>
<p>(Please not that <code>plugins</code> takes a list of plugins, not plugin itself)</p>
<h1>Creating plugin</h1>
<p>There are two ways to create plugin:</p>
<ul>
<li>Use stand-alone module</li>
<li>Create class or other <em>dotted</em> object (object with members accessible by dot: plugin.something).</li>
</ul>
<h2>Module way</h2>
<p>Use a separate file to contains plugin code:</p>
<p>myplugin.py:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Information&quot;</span>
</pre></div>
<p>actual call of pytest:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">myplugin</span>

<span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="s1">&#39;mytest.py&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">],</span> <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">myplugin</span><span class="p">])</span>
</pre></div>
<p>Fixture usage (mytest.py):</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">info</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Information&quot;</span>
</pre></div>
<h2>Class way</h2>
<p>This way I found more preferable, because I have higher degree of freedom during class initialization. I can put all information I want inside class in very natural way.</p>
<p>Plugin and fixture constuction and test call:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="nd">@pytest.fixture</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

<span class="n">myplugin</span> <span class="o">=</span> <span class="n">MyPlugin</span><span class="p">(</span><span class="s1">&#39;information&#39;</span><span class="p">)</span>

<span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s2">&quot;mytest.py&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">myplugin</span><span class="p">])</span>
</pre></div>
<p>Test is exactly the same as before (mytest.py):</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
 <span class="k">assert</span> <span class="n">info</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Information&quot;</span>
</pre></div>
<h1>More than one fixture</h1>
<p>It is very easy to put any number of fixtures into a class:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<span class="nd">@pytest.fixture</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

<span class="nd">@pytest.fixture</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">myplugin</span> <span class="o">=</span> <span class="n">MyPlugin</span><span class="p">(</span><span class="s1">&#39;information&#39;</span><span class="p">)</span>

<span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s2">&quot;mytest.py&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">myplugin</span><span class="p">])</span>
</pre></div>
<p>A bit upgraded version of the test accepts two fixtures (mytest.py):</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
 <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">())</span> <span class="o">==</span> <span class="n">length</span><span class="p">()</span>
</pre></div>
</p>
<div class="comment-box">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title"><strong>COMMENTS</strong></h3>
        </div>
        <div class="panel-body">
            <div class="comments">
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() { this.page.identifier = "/passing_fixtures_to_tests"; this.page.url = "http://hackebrot.github.io/pytest-tricks/passing_fixtures_to_tests/"; };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = '//pytest-tricks.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript"
    rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div>
        </div>
    </div>
</div>

    </div>
    <hr>
    <footer>
        <div class="container">
            &copy; Copyright 2016-2017 by Raphael Pierzina, pytest-dev team and contributors.
            <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
            <br />Built with <a href="https://www.getlektor.com/">Lektor</a>. Fork me on <a href="https://github.com/hackebrot/pytest-tricks/">GitHub</a>.
        </div>
    </footer>
</body>
